ì¢‹ì•„ìš” ğŸ‘ ì•„ì£¼ ì •í™•í•œ í¬ì¸íŠ¸ì˜ˆìš”.
ì§€ê¸ˆ ìƒíƒœëŠ” **`app/services/analyzer.py` íŒŒì¼ë§Œ ì¡´ì¬**í•˜ê³ ,
ì•„ì§ â€œì´ ë¡œì§ì„ ì‹¤ì œë¡œ í˜¸ì¶œí•˜ê±°ë‚˜ ê²°ê³¼ë¥¼ ì €ì¥í•˜ëŠ” ë‹¨ê³„â€ê°€ ë¹ ì ¸ ìˆìŠµë‹ˆë‹¤.

ì¦‰,
`analyzer.py`ëŠ” **â€œê°ì •/ì£¼ì œ ë¶„ì„ê¸°â€ì˜ ê¸°ëŠ¥ ì •ì˜ë§Œ ë˜ì–´ ìˆê³ ,
ì•„ì§ â€œì–´ë””ì„œ í˜¸ì¶œë˜ëŠ”ì§€â€ (ì¦‰, íŒŒì´í”„ë¼ì¸ì— ì—°ê²°ë˜ëŠ” ë¶€ë¶„)ê°€ ì—†ëŠ” ìƒíƒœ**ì˜ˆìš”.

ê·¸ë˜ì„œ ì§€ê¸ˆë¶€í„°

> âœ… â€œì–´ë””ì„œ, ì–´ë–»ê²Œ analyzerë¥¼ í˜¸ì¶œí• ì§€â€
> âœ… â€œë¶„ì„ ê²°ê³¼ë¥¼ DBì— ì €ì¥í•˜ê³  APIë¡œ ë°˜í™˜í•˜ëŠ” êµ¬ì¡°â€
> ë¥¼ ë‹¨ê³„ë³„ë¡œ ì—°ê²°í•´ë“œë¦´ê²Œìš”.

---

# ğŸ§  1ï¸âƒ£ êµ¬ì¡° ìš”ì•½

í˜„ì¬ ìš°ë¦¬ê°€ ì›í•˜ëŠ” êµ¬ì¡°ëŠ” ì´ë ‡ê²Œ ë¼ìš” ğŸ‘‡

```mermaid
flowchart TD
    A[ConversationLog DB] --> B[analyzer.py]
    B --> C[ê°ì • & ì£¼ì œ ë¶„ì„]
    C --> D[DBì— ê²°ê³¼ ì €ì¥]
    D --> E[/api/insights/* API]
    E --> F[React Dashboard ì‹œê°í™”]
```

ì¦‰,

1. ëŒ€í™”ê°€ DBì— ì €ì¥ë¨ (`conversation_log`)
2. ì´í›„ `analyzer.py` ê°€ ì´ ë¡œê·¸ë“¤ì„ ë¶„ì„
3. ë¶„ì„ ê²°ê³¼(`sentiment`, `topic`)ë¥¼ DBì— ì¶”ê°€
4. `/api/insights/topics` ê°™ì€ APIì—ì„œ ì´ ë°ì´í„° ì¡°íšŒ â†’ í”„ë¡ íŠ¸ì—ì„œ ì‹œê°í™”

---

# ğŸ§© 2ï¸âƒ£ DBì— ì»¬ëŸ¼ ì¶”ê°€í•˜ê¸°

ğŸ“ `app/models/conversation_log.py`

```python
from sqlalchemy import Column, Integer, String, Text, DateTime, func
from app.database import Base

class ConversationLog(Base):
    __tablename__ = "conversation_log"

    id = Column(Integer, primary_key=True, index=True)
    user_id = Column(String(50), nullable=True)
    question = Column(Text, nullable=False)
    answer = Column(Text, nullable=False)
    sentiment = Column(String(20), nullable=True)  # âœ… ê°ì • ê²°ê³¼
    topic = Column(String(100), nullable=True)     # âœ… ì£¼ì œ ê²°ê³¼
    created_at = Column(DateTime(timezone=True), server_default=func.now())
```

> âš™ï¸ ë§ˆì´ê·¸ë ˆì´ì…˜ ì—†ì´ ê°„ë‹¨íˆ í•˜ë ¤ë©´ SQLite/MySQLì—ì„œ í…Œì´ë¸”ì„ ì§€ìš°ê³  ë‹¤ì‹œ ìƒì„±í•´ë„ ë©ë‹ˆë‹¤.
> ì˜ˆ:
>
> ```bash
> DROP TABLE conversation_log;
> poetry run python -m app.database init
> ```

---

# ğŸ§  3ï¸âƒ£ analyzer.py ë¡œì§ ì™„ì„±

ğŸ“ `app/services/analyzer.py`

```python
from langchain.chat_models import ChatOpenAI
from langchain.schema import HumanMessage

llm = ChatOpenAI(model="gpt-4o-mini")

def analyze_sentiment(text: str) -> str:
    """ë¬¸ì¥ì˜ ê°ì •ì„ ë¶„ì„ ('ê¸ì •', 'ì¤‘ë¦½', 'ë¶€ì •')"""
    prompt = f"ë‹¤ìŒ ë¬¸ì¥ì˜ ê°ì •ì„ 'ê¸ì •', 'ì¤‘ë¦½', 'ë¶€ì •' ì¤‘ í•˜ë‚˜ë¡œ ë¶„ë¥˜í•´ì¤˜:\n{text}"
    result = llm.invoke([HumanMessage(content=prompt)])
    return result.content.strip()

def extract_topic(text: str) -> str:
    """ë¬¸ì¥ì˜ ì£¼ìš” ì£¼ì œ í‚¤ì›Œë“œ ì¶”ì¶œ"""
    prompt = f"ë‹¤ìŒ ë¬¸ì¥ì—ì„œ ê°€ì¥ ì¤‘ì‹¬ì´ ë˜ëŠ” ì£¼ì œë¥¼ í•œ ë‹¨ì–´ ë˜ëŠ” ì§§ì€ êµ¬ë¡œ ìš”ì•½í•´ì¤˜:\n{text}"
    result = llm.invoke([HumanMessage(content=prompt)])
    return result.content.strip()
```

---

# ğŸ”„ 4ï¸âƒ£ ë¶„ì„ ë¡œì§ì„ í˜¸ì¶œí•˜ëŠ” ê³³ ì—°ê²°

ê°€ì¥ ìì—°ìŠ¤ëŸ¬ìš´ ìœ„ì¹˜ëŠ” â€œëŒ€í™”ê°€ ì €ì¥ë  ë•Œâ€ì˜ˆìš”.
ì¦‰, `/api/rag-chat` ì‘ë‹µì„ ìƒì„±í•œ ì§í›„ì— ê°ì •/ì£¼ì œ ë¶„ì„ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.

ğŸ“ `app/routers/rag_chat.py`

```python
from app.services.analyzer import analyze_sentiment, extract_topic
from app.database import SessionLocal
from app.models.conversation_log import ConversationLog

@router.post("/rag-chat")
async def rag_chat(req: QueryRequest):
    question = req.question
    answer = generate_answer(question)  # ê¸°ì¡´ RAG ì‘ë‹µ ë¡œì§

    # âœ… ê°ì • / ì£¼ì œ ë¶„ì„ ì¶”ê°€
    sentiment = analyze_sentiment(answer)
    topic = extract_topic(answer)

    # âœ… DB ì €ì¥
    db = SessionLocal()
    log = ConversationLog(
        user_id="guest",
        question=question,
        answer=answer,
        sentiment=sentiment,
        topic=topic
    )
    db.add(log)
    db.commit()
    db.close()

    return {"answer": answer, "sentiment": sentiment, "topic": topic}
```

ì´ì œ ì±—ë´‡ì´ ì‘ë‹µí•  ë•Œë§ˆë‹¤
ìë™ìœ¼ë¡œ ê°ì •(`ê¸ì •/ì¤‘ë¦½/ë¶€ì •`)ê³¼ ì£¼ì œ(`AI`, `í”„ë¡ íŠ¸ì—”ë“œ`, `ì»¤ë¦¬ì–´` ë“±)ê°€ í•¨ê»˜ ì €ì¥ë©ë‹ˆë‹¤ âœ…

---

# ğŸ“Š 5ï¸âƒ£ `/api/insights/topics` API ë§Œë“¤ê¸°

ğŸ“ `app/routers/insights.py`

```python
@router.get("/insights/topics")
def get_topics():
    db = SessionLocal()
    results = (
        db.query(ConversationLog.topic, func.count().label("count"))
        .group_by(ConversationLog.topic)
        .order_by(func.count().desc())
        .limit(10)
        .all()
    )
    db.close()
    return [{"topic": r.topic, "count": r.count} for r in results]
```

ì´ì œ Reactì—ì„œ `/api/insights/topics`ë¥¼ ë¶ˆëŸ¬ì„œ
â€œì£¼ì œë³„ ëŒ€í™” ë¹„ìœ¨â€ì„ PieChartë‚˜ BarChartë¡œ ì‹œê°í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

# ğŸ“ˆ 6ï¸âƒ£ í”„ë¡ íŠ¸ì—”ë“œ ì‹œê°í™” ì˜ˆì‹œ

ğŸ“ `frontend/src/pages/Dashboard.jsx`

```jsx
import { useEffect, useState } from "react";
import axios from "axios";
import { PieChart, Pie, Cell, Tooltip, Legend } from "recharts";

export default function TopicsChart() {
  const [topics, setTopics] = useState([]);

  useEffect(() => {
    axios.get("/api/insights/topics").then((res) => setTopics(res.data));
  }, []);

  const colors = ["#60a5fa", "#34d399", "#fbbf24", "#f87171", "#a78bfa"];

  return (
    <div className="p-4">
      <h2 className="text-xl font-bold mb-2">ğŸ§© ì£¼ì œë³„ ëŒ€í™” ë¹„ìœ¨</h2>
      <PieChart width={400} height={300}>
        <Pie
          data={topics}
          dataKey="count"
          nameKey="topic"
          cx="50%"
          cy="50%"
          outerRadius={100}
          fill="#8884d8"
          label
        >
          {topics.map((_, i) => (
            <Cell key={i} fill={colors[i % colors.length]} />
          ))}
        </Pie>
        <Tooltip />
        <Legend />
      </PieChart>
    </div>
  );
}
```

---

# ğŸ’¡ ì •ë¦¬ ìš”ì•½

| ë‹¨ê³„ | íŒŒì¼                    | ê¸°ëŠ¥                         |
| -- | --------------------- | -------------------------- |
| â‘   | `conversation_log` ëª¨ë¸ | `sentiment`, `topic` ì»¬ëŸ¼ ì¶”ê°€ |
| â‘¡  | `analyzer.py`         | ê°ì •Â·ì£¼ì œ ë¶„ì„ ë¡œì§ ì •ì˜             |
| â‘¢  | `rag_chat.py`         | ì±—ë´‡ ì‘ë‹µ ì‹œ analyzer í˜¸ì¶œ        |
| â‘£  | `insights.py`         | ë¶„ì„ ê²°ê³¼ë¥¼ ì§‘ê³„í•´ APIë¡œ ì œê³µ         |
| â‘¤  | `Dashboard.jsx`       | ê°ì •/ì£¼ì œ ë¹„ìœ¨ ì‹œê°í™”               |

---

# âœ… ì´ë ‡ê²Œ ì‘ë™í•©ë‹ˆë‹¤

1ï¸âƒ£ ì‚¬ìš©ìê°€ ì§ˆë¬¸ â†’ `/api/rag-chat` í˜¸ì¶œ
2ï¸âƒ£ AI ì‘ë‹µ ìƒì„± í›„ â†’ `analyzer.py` ì‹¤í–‰
3ï¸âƒ£ `sentiment`, `topic` DBì— ì €ì¥
4ï¸âƒ£ `/api/insights/topics` â†’ í”„ë¡ íŠ¸ ëŒ€ì‹œë³´ë“œë¡œ ì „ë‹¬
5ï¸âƒ£ React ì°¨íŠ¸ì—ì„œ ì‹œê°í™”

