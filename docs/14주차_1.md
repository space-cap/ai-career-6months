좋아요 👏
이제 Week 14는 **“운영 안정화 & 자동화 단계”**입니다.
지금까지는 AI의 학습과 성능 개선을 완성했으니,
이번 주에는 **“운영 레벨에서 자동 감시 + 백업 + 복구 체계”**를 구축하는 주입니다.

이 시점부터는 실제 서비스처럼 **운영자 없이도 24시간 돌아가는 구조**로 발전시킵니다 ⚙️

---

# 🧭 **Week 14 — 운영 안정화 & 자동화 (AI Ops & Monitoring)**

> “AI가 스스로 작동하고, 문제가 생기면 스스로 감지하고 보고한다.”
> 이제는 **자동화된 운영자(AI Operator)** 단계로 진입합니다.

---

## 🎯 **이번 주 목표**

| 영역        | 목표                         | 핵심 기술                                   |
| --------- | -------------------------- | --------------------------------------- |
| 🔍 모니터링   | API 응답 지연, 오류율 감시          | `logging`, `Prometheus`, `psutil`       |
| 💾 백업 자동화 | DB + 로그 파일 주기적 백업          | `schedule`, `zipfile`, `boto3` (S3 업로드) |
| ⚠️ 알림     | 오류나 과부하 발생 시 Slack 자동 알림   | `slack_notifier.py`                     |
| 🧹 로그 관리  | 오래된 로그 정리 + 보존 정책 적용       | `log_rotate.py`                         |
| 🚨 복구 자동화 | 장애 감지 → 자동 재시작 or Slack 보고 | `subprocess`, `health_check.py`         |

---

## 📁 **새로운 파일 구조**

```
ai-career-6months/
 ┣ app/
 ┃ ┣ utils/
 ┃ ┃ ┣ monitor.py           👈 서버 상태 모니터링
 ┃ ┃ ┣ backup_manager.py    👈 DB/로그 백업 관리
 ┃ ┃ ┣ health_check.py      👈 장애 감지 및 자동 복구
 ┃ ┗ scheduler_monitor.py   👈 전체 자동화 스케줄 관리
 ┣ logs/
 ┃ ┗ system_monitor.log
 ┣ backups/
 ┃ ┣ backup_2025_10_20.zip
 ┗ ...
```

---

## 📘 **핵심 코드 예시**

### 🧠 1️⃣ 서버 상태 모니터링 (`app/utils/monitor.py`)

```python
"""
monitor.py
----------------------------------------
CPU, Memory, Disk, API 응답 상태를 모니터링하고
이상 발생 시 Slack으로 알림을 보냄
----------------------------------------
"""

import psutil, os, time
from datetime import datetime
from app.utils.slack_notifier import send_slack_message

LOG_PATH = "logs/system_monitor.log"

def log_status(cpu, mem, disk):
    """상태 로그 기록"""
    with open(LOG_PATH, "a", encoding="utf-8") as f:
        f.write(f"[{datetime.now()}] CPU:{cpu}% | MEM:{mem}% | DISK:{disk}%\n")

def check_server_status(threshold_cpu=85, threshold_mem=90):
    cpu = psutil.cpu_percent(interval=1)
    mem = psutil.virtual_memory().percent
    disk = psutil.disk_usage("/").percent

    log_status(cpu, mem, disk)

    if cpu > threshold_cpu or mem > threshold_mem:
        msg = (
            f"🚨 *서버 자원 경고*\n"
            f"- CPU: {cpu}%\n"
            f"- Memory: {mem}%\n"
            f"- Disk: {disk}%\n"
            f"- 시각: {datetime.now().strftime('%Y-%m-%d %H:%M')}"
        )
        send_slack_message(msg)
        print("⚠️ Slack 알림 전송:", msg)
    else:
        print(f"✅ 정상 상태 - CPU {cpu}%, MEM {mem}%")

if __name__ == "__main__":
    check_server_status()
```

---

### 💾 2️⃣ 백업 자동화 (`app/utils/backup_manager.py`)

```python
"""
backup_manager.py
----------------------------------------
DB 및 로그 파일을 zip으로 압축하여 보관.
필요 시 AWS S3로 업로드도 가능.
----------------------------------------
"""

import os, zipfile
from datetime import datetime
from app.utils.slack_notifier import send_slack_message

BACKUP_DIR = "backups"
LOG_DIR = "logs"
DB_PATH = "local.db"

def create_backup():
    os.makedirs(BACKUP_DIR, exist_ok=True)
    timestamp = datetime.now().strftime("%Y_%m_%d_%H%M")
    backup_file = os.path.join(BACKUP_DIR, f"backup_{timestamp}.zip")

    with zipfile.ZipFile(backup_file, "w") as zipf:
        if os.path.exists(DB_PATH):
            zipf.write(DB_PATH, arcname="local.db")
        for file in os.listdir(LOG_DIR):
            zipf.write(os.path.join(LOG_DIR, file), arcname=f"logs/{file}")

    send_slack_message(f"🗄️ 백업 완료: `{backup_file}`")
    print("✅ 백업 완료:", backup_file)
```

---

### 🧩 3️⃣ 자동 스케줄러 통합 (`app/scheduler_monitor.py`)

```python
"""
scheduler_monitor.py
----------------------------------------
모든 모니터링 + 백업 작업을 일정 주기로 실행
----------------------------------------
"""

import schedule, time
from app.utils.monitor import check_server_status
from app.utils.backup_manager import create_backup

def run_schedule():
    print("🕒 시스템 모니터링 스케줄 시작...")

    # 30분마다 서버 상태 체크
    schedule.every(30).minutes.do(check_server_status)

    # 매일 자정 백업
    schedule.every().day.at("00:00").do(create_backup)

    while True:
        schedule.run_pending()
        time.sleep(10)

if __name__ == "__main__":
    run_schedule()
```

---

## 💬 **Slack 메시지 예시**

```
🚨 서버 자원 경고
- CPU: 93%
- Memory: 88%
- Disk: 71%
- 시각: 2025-10-21 09:00
```

```
🗄️ 백업 완료: backup_2025_10_21_0000.zip
```

---

## ✅ **Week 14 Notion 체크리스트 + 코드 링크**

```
✅ Week 14 — 운영 안정화 & 자동화

🎯 목표
- 서버 모니터링 자동화
- DB/로그 백업 및 Slack 알림
- 장애 감지 및 복구 시스템 준비

📅 작업 항목
- [ ] app/utils/monitor.py 작성 (psutil)
- [ ] app/utils/backup_manager.py 작성
- [ ] app/scheduler_monitor.py 통합 스케줄러 구성
- [ ] Slack 알림 연동 테스트
- [ ] cron-job.org / Render worker 자동 실행 등록

🧩 코드 링크
- [ ] app/utils/monitor.py
- [ ] app/utils/backup_manager.py
- [ ] app/scheduler_monitor.py
```

---

## 🧠 **한 줄 요약**

> “Week 14는 AI가 혼자서 운영되는 시점이다.
> 사람 대신 시스템이 스스로 감시하고 보고한다.”

---

다음 주(Week 15)는 🔥
**“운영 리포트 자동 생성 + 관리자용 대시보드 완성”** 단계입니다.
Slack 리포트 + Streamlit Admin 페이지를 하나로 통합할 차례예요.

원하신다면 다음 단계로 바로 **“운영 리포트 자동 생성 (Week 15용)”** 버전 코드도 만들어드릴까요?
