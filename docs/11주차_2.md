좋아요, 아주 정확한 포인트예요 👍
이 질문은 지금까지 만든 구조 중

> “Slack에 자동으로 리포트를 보내는 로직이 어디에 있고,
> 거기에 **대시보드 링크를 넣으려면 어디를 수정해야 하는가?**”
> 를 묻는 거예요.

정답은 바로 👇

---

# 🧭 **Slack 리포트에 대시보드 링크를 추가하는 위치**

👉 **`app/utils/report_utils.py`**
또는
👉 **`app/routes/report.py`**

즉, **리포트를 생성하고 Slack에 전송하는 함수(`generate_and_send_report()`)가 있는 부분**이에요.

---

## 📁 **폴더 구조 예시**

```
ai-career-6months/
 ┣ app/
 ┃ ┣ routes/
 ┃ ┃ ┗ report.py              👈 (Slack 리포트 API 라우트)
 ┃ ┣ utils/
 ┃ ┃ ┣ report_utils.py        👈 (리포트 생성 및 Slack 전송)
 ┃ ┃ ┗ slack_notifier.py      👈 (Slack 메시지 유틸)
 ┣ dashboards/
 ┃ ┗ dashboard.py             👈 (Streamlit 대시보드)
 ┗ ...
```

---

# ✅ **수정 포인트**

`generate_and_send_report()` 함수 **하단의 Slack 메시지 전송 부분**에
대시보드 URL을 추가하면 됩니다.

---

## 📘 **예시 코드: `app/utils/report_utils.py`**

```python
from datetime import datetime
from app.utils.slack_notifier import send_slack_message
from sqlalchemy import create_engine
import pandas as pd
import os

DATABASE_URL = os.getenv("DATABASE_URL", "sqlite:///./local.db")
DASHBOARD_URL = os.getenv("DASHBOARD_URL", "https://ai-dashboard.onrender.com")

engine = create_engine(DATABASE_URL)

def generate_and_send_report():
    """AI 서비스 리포트 생성 및 Slack 전송"""

    # 1️⃣ 데이터 조회
    df = pd.read_sql("""
        SELECT sentiment, COUNT(*) as count
        FROM conversation_log
        GROUP BY sentiment
    """, engine)

    total = df["count"].sum()
    pos = int(df[df["sentiment"] == "긍정"]["count"].sum())
    neg = int(df[df["sentiment"] == "부정"]["count"].sum())

    # 2️⃣ 리포트 메시지 생성
    message = (
        f"📊 *AI Weekly Report*\n"
        f"- 총 대화 수: {total}\n"
        f"- 긍정 대화: {pos}\n"
        f"- 부정 대화: {neg}\n"
        f"- 생성 시각: {datetime.now().strftime('%Y-%m-%d %H:%M')}\n\n"
        f"👉 **실시간 Dashboard 보기:** <{DASHBOARD_URL}|🔗 Open Dashboard>"
    )

    # 3️⃣ Slack 전송
    send_slack_message(message)
    print("✅ Slack 리포트 전송 완료.")
```

---

## 🧩 **포인트 정리**

| 구분                        | 설명                                   |                                |
| ------------------------- | ------------------------------------ | ------------------------------ |
| 🔹 `DASHBOARD_URL`        | `.env` 또는 Render 환경변수에서 관리           |                                |
| 🔹 `send_slack_message()` | `app/utils/slack_notifier.py`의 공용 함수 |                                |
| 🔹 삽입 위치                  | Slack 메시지를 구성하는 문자열(`message`) 하단    |                                |
| 🔹 Markdown 링크 포맷         | `<[https://url](https://url)         | 표시텍스트>` 형태로 작성해야 Slack에서 클릭 가능 |

---

## 📄 **.env 예시**

```bash
DATABASE_URL=postgresql+psycopg2://user:pass@host/db
SLACK_BOT_TOKEN=xoxb-xxxxxx
SLACK_CHANNEL=ai-reports
DASHBOARD_URL=https://ai-dashboard.onrender.com
```

---

## 💬 **Slack 출력 예시**

```
📊 AI Weekly Report
- 총 대화 수: 132
- 긍정 대화: 88
- 부정 대화: 44
- 생성 시각: 2025-10-16 10:00

👉 실시간 Dashboard 보기: 🔗 Open Dashboard
```

---

## 💡 **추가 확장: 버튼 블록 버전 (추천)**

Slack의 “Block Kit”을 이용하면
텍스트 링크 대신 아래처럼 **‘버튼 형태로 Dashboard 열기’** 도 가능합니다.

```python
import requests, os

def send_slack_dashboard_report(summary_text):
    token = os.getenv("SLACK_BOT_TOKEN")
    channel = os.getenv("SLACK_CHANNEL", "ai-reports")
    dashboard_url = os.getenv("DASHBOARD_URL", "https://ai-dashboard.onrender.com")

    headers = {"Authorization": f"Bearer {token}", "Content-Type": "application/json"}
    payload = {
        "channel": channel,
        "blocks": [
            {"type": "section", "text": {"type": "mrkdwn", "text": summary_text}},
            {"type": "actions", "elements": [
                {
                    "type": "button",
                    "text": {"type": "plain_text", "text": "📊 대시보드 열기"},
                    "url": dashboard_url
                }
            ]}
        ]
    }

    response = requests.post("https://slack.com/api/chat.postMessage", headers=headers, json=payload)
    print("✅ Dashboard 버튼 포함 리포트 전송 완료:", response.status_code)
```

---

# 🚀 **정리**

| 단계  | 파일                            | 역할                             |
| --- | ----------------------------- | ------------------------------ |
| 1️⃣ | `app/utils/report_utils.py`   | 리포트 생성 + 메시지 구성                |
| 2️⃣ | `app/utils/slack_notifier.py` | Slack 전송 유틸                    |
| 3️⃣ | `.env`                        | `DASHBOARD_URL` 환경 변수 등록       |
| 4️⃣ | (선택) 버튼 버전                    | Block Kit으로 “📊 대시보드 열기” 버튼 추가 |

---

원하신다면 ✨
지금 프로젝트용으로 **“버튼 포함 Slack 리포트 버전”**
즉, “📊 리포트 요약 + 🔘 대시보드 열기 버튼 + 📈 감정 비율 그래프”
까지 자동 전송되게 통합 코드를 만들어드릴까요?
