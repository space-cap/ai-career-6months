좋아요 👏
이제 **Week 15**는 프로젝트의 **운영 리포트 자동화 & 관리자용 대시보드 완성 단계**입니다.

Week 14까지는 AI 시스템이 “스스로 감시하고 보고”하는 수준이었다면,
이번 주는 **운영자(Admin)**가 모든 흐름을 한눈에 보고, Slack 리포트와도 연결되는
**운영용 Dashboard + 리포트 자동화**를 만드는 주입니다 💼

---

# 🧭 **Week 15 — 운영 리포트 자동 생성 + 관리자 대시보드 완성**

> “AI가 일주일 동안 어떻게 작동했는지 한눈에 보고,
> 클릭 한 번으로 Slack 리포트까지 공유한다.”

---

## 🎯 **이번 주 목표**

| 구분           | 목표                                                      | 핵심 기술                           |
| ------------ | ------------------------------------------------------- | ------------------------------- |
| 📊 데이터 통합    | feedback_log + conversation_log + evaluation_log 통합 리포트 | SQLAlchemy + Pandas             |
| 🧾 리포트 자동 생성 | 매주 AI 성능/운영 통계 자동 PDF 생성                                | `reportlab`                     |
| 💬 Slack 전송  | PDF 리포트를 Slack 채널에 자동 업로드                               | `slack_sdk`                     |
| 🧠 관리자 대시보드  | Streamlit 기반 “Admin Panel” 탭 추가                         | `streamlit`, `altair`, `plotly` |
| ⚙️ 주간 스케줄    | 매주 월요일 09:00 자동 리포트 생성                                  | `schedule`, `cron-job.org`      |

---

## 📁 **새로운 구성**

```
ai-career-6months/
 ┣ app/
 ┃ ┣ utils/
 ┃ ┃ ┣ report_generator.py    👈 PDF 리포트 생성
 ┃ ┃ ┣ admin_dashboard.py     👈 Streamlit 관리자 페이지
 ┃ ┃ ┗ slack_uploader.py      👈 Slack 파일 업로드
 ┣ reports/
 ┃ ┣ weekly_report_2025_10_20.pdf
 ┣ logs/
 ┗ ...
```

---

## 🧾 **1️⃣ 리포트 자동 생성 스크립트 (`app/utils/report_generator.py`)**

```python
"""
report_generator.py
----------------------------------------
AI 운영 주간 리포트를 자동 생성하여 PDF로 저장.
Slack 전송 모듈(slack_uploader.py)과 연동됨.
----------------------------------------
"""

import os
from datetime import datetime, timedelta
from sqlalchemy import create_engine, text
from reportlab.lib.pagesizes import A4
from reportlab.pdfgen import canvas

DATABASE_URL = os.getenv("DATABASE_URL", "sqlite:///./local.db")
REPORT_DIR = "reports"
os.makedirs(REPORT_DIR, exist_ok=True)

engine = create_engine(DATABASE_URL)

def generate_weekly_report():
    start_date = (datetime.now() - timedelta(days=7)).strftime("%Y-%m-%d")
    end_date = datetime.now().strftime("%Y-%m-%d")
    report_path = os.path.join(REPORT_DIR, f"weekly_report_{end_date}.pdf")

    with engine.begin() as conn:
        feedback_stats = conn.execute(text("""
            SELECT
              SUM(CASE WHEN feedback='like' THEN 1 ELSE 0 END) AS likes,
              SUM(CASE WHEN feedback='dislike' THEN 1 ELSE 0 END) AS dislikes,
              COUNT(*) AS total
            FROM feedback_log
            WHERE created_at BETWEEN :start AND :end
        """), {"start": start_date, "end": end_date}).fetchone()

        conv_count = conn.execute(text("""
            SELECT COUNT(*) FROM conversation_log
            WHERE created_at BETWEEN :start AND :end
        """), {"start": start_date, "end": end_date}).scalar()

        avg_score = conn.execute(text("""
            SELECT AVG(score) FROM conversation_evaluation
            WHERE created_at BETWEEN :start AND :end
        """), {"start": start_date, "end": end_date}).scalar()

    c = canvas.Canvas(report_path, pagesize=A4)
    c.setFont("Helvetica-Bold", 16)
    c.drawString(50, 800, "🧾 AI 주간 운영 리포트")
    c.setFont("Helvetica", 12)
    c.drawString(50, 770, f"기간: {start_date} ~ {end_date}")
    c.drawString(50, 740, f"총 대화 수: {conv_count}")
    c.drawString(50, 720, f"평균 평가 점수: {avg_score:.2f}")
    c.drawString(50, 700, f"좋아요 수: {feedback_stats.likes}")
    c.drawString(50, 680, f"싫어요 수: {feedback_stats.dislikes}")
    c.drawString(50, 660, f"총 피드백 수: {feedback_stats.total}")
    c.drawString(50, 620, f"생성일시: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}")
    c.save()

    print(f"✅ 주간 리포트 생성 완료: {report_path}")
    return report_path
```

---

## 💬 **2️⃣ Slack 업로드 모듈 (`app/utils/slack_uploader.py`)**

```python
"""
slack_uploader.py
----------------------------------------
PDF 파일을 지정된 Slack 채널로 업로드
----------------------------------------
"""

import os
from slack_sdk import WebClient
from slack_sdk.errors import SlackApiError

SLACK_BOT_TOKEN = os.getenv("SLACK_BOT_TOKEN")
SLACK_CHANNEL = os.getenv("SLACK_CHANNEL", "#ai-reports")

client = WebClient(token=SLACK_BOT_TOKEN)

def upload_to_slack(file_path):
    try:
        response = client.files_upload_v2(
            channel=SLACK_CHANNEL,
            file=file_path,
            initial_comment=f"📄 *AI 주간 운영 리포트 업로드 완료!*"
        )
        print("✅ Slack 업로드 성공:", response.data)
    except SlackApiError as e:
        print("❌ Slack 업로드 실패:", e)
```

---

## ⚙️ **3️⃣ 통합 실행기 (`app/generate_weekly_report.py`)**

```python
from app.utils.report_generator import generate_weekly_report
from app.utils.slack_uploader import upload_to_slack

if __name__ == "__main__":
    path = generate_weekly_report()
    upload_to_slack(path)
```

---

## 📈 **4️⃣ 관리자 대시보드 (Streamlit)**

📄 `dashboards/admin_dashboard.py`

```python
import streamlit as st
import pandas as pd
from sqlalchemy import create_engine, text

DATABASE_URL = "sqlite:///./local.db"
engine = create_engine(DATABASE_URL)

st.set_page_config(page_title="AI Admin Dashboard", layout="wide")

st.title("🧠 AI 운영 관리자 대시보드")
st.markdown("---")

tab1, tab2 = st.tabs(["📊 AI Performance", "🧾 Feedback Summary"])

with tab1:
    st.subheader("AI 평균 점수 추이")
    df = pd.read_sql(text("SELECT DATE(created_at) as date, AVG(score) as avg_score FROM conversation_evaluation GROUP BY DATE(created_at)"), engine)
    st.line_chart(df, x="date", y="avg_score")

with tab2:
    st.subheader("좋아요 / 싫어요 추이")
    fb = pd.read_sql(text("""
        SELECT DATE(created_at) as date,
               SUM(CASE WHEN feedback='like' THEN 1 ELSE 0 END) AS likes,
               SUM(CASE WHEN feedback='dislike' THEN 1 ELSE 0 END) AS dislikes
        FROM feedback_log
        GROUP BY DATE(created_at)
    """), engine)
    st.bar_chart(fb.set_index("date"))
```

---

## 🕒 **5️⃣ 자동 실행 스케줄 (cron-job.org or schedule 모듈)**

매주 월요일 09:00에 자동 실행되도록 설정:

```python
import schedule, time
from app.generate_weekly_report import generate_weekly_report, upload_to_slack

def run_weekly():
    path = generate_weekly_report()
    upload_to_slack(path)

schedule.every().monday.at("09:00").do(run_weekly)

while True:
    schedule.run_pending()
    time.sleep(60)
```

---

## ✅ **Week 15 Notion 체크리스트 + 코드 링크**

```
✅ Week 15 — 운영 리포트 자동 생성 + 관리자 대시보드 완성

🎯 목표
- AI 운영/피드백 통계 자동 PDF 리포트 생성
- Slack 자동 업로드
- Streamlit 기반 관리자 페이지 완성

📅 작업 항목
- [ ] app/utils/report_generator.py 작성
- [ ] app/utils/slack_uploader.py 작성
- [ ] app/generate_weekly_report.py 통합 실행
- [ ] dashboards/admin_dashboard.py 생성
- [ ] cron-job.org 매주 자동 실행 등록

🧩 코드 링크
- [ ] app/utils/report_generator.py
- [ ] app/utils/slack_uploader.py
- [ ] app/generate_weekly_report.py
- [ ] dashboards/admin_dashboard.py
```

---

## 🧠 **한 줄 요약**

> “Week 15는 AI가 ‘보고하는 시스템’으로 진화하는 시점이다.
> 관리자는 데이터로, Slack은 리포트로 — 완전한 AI 운영 자동화 달성.”

---

원하신다면 🔥
이 리포트를 Slack에서 **버튼 클릭으로 즉시 생성(trigger)** 하거나
Dashboard에서 **“Generate Report Now” 버튼으로 즉시 생성**하는 버전도 만들어드릴까요?
(→ 완전한 양방향 자동화 관리 시스템 완성 단계)
