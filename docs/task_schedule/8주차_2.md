좋아요 🔥
이건 정말 훌륭한 선택이에요.
**Render + Neon.tech PostgreSQL 통합 구조**는 2025년 기준으로
💰 **무료**, 🔒 **안정적**, ⚙️ **FastAPI 완벽 호환** 이라서
지금 진행 중인 “AI Career 6 Months” 프로젝트에 **가장 이상적인 배포 조합**이에요.

---

# 🧩 목표

> Render에서 FastAPI 앱을 배포하고,
> 데이터베이스는 Neon.tech의 PostgreSQL을 연결하는 구성으로 설정합니다.

구성 요약 👇

```
🌍 Render (App) → 🔗 Neon.tech (PostgreSQL)
```

---

# 🏗 1️⃣ Neon.tech에서 DB 생성

1. [https://neon.tech](https://neon.tech) 접속 → **Sign up**
2. “Create Project” 클릭 → **PostgreSQL** 프로젝트 생성
3. 생성 후 “Connection Details” → `SQLAlchemy` 드라이버 선택
   예시:

   ```
   postgresql+psycopg2://neondb_owner:xxxxxx@ep-calm-breeze-123456.ap-southeast-1.aws.neon.tech/neondb?sslmode=require
   ```
4. 이 URL을 복사해 `.env.prod` 파일에 `DATABASE_URL`로 저장

---

# ⚙️ 2️⃣ `.env` 구조 설정

📁 프로젝트 루트 (`ai-career-6months/.env.prod`)

```bash
# ==== Production 환경 설정 ====
ENV=production
OPENAI_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxx
DATABASE_URL=postgresql+psycopg2://neondb_owner:xxxxxx@ep-calm-breeze-123456.ap-southeast-1.aws.neon.tech/neondb?sslmode=require
CHROMA_PATH=./chroma_db
```

📁 로컬용 `.env.local`

```bash
# ==== Local 환경 ====
ENV=local
OPENAI_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxx
DATABASE_URL=sqlite:///./local.db
CHROMA_PATH=./chroma_db_local
```

---

# 🧠 3️⃣ `config.py` (환경 구분 자동 로딩)

📁 `app/config.py`

```python
import os
from dotenv import load_dotenv

# ✅ ENV 값에 따라 서로 다른 .env 파일을 로드
env_mode = os.getenv("ENV", "local")
env_file = ".env.prod" if env_mode == "production" else ".env.local"
load_dotenv(env_file)

# ✅ 환경 변수 불러오기
OPENAI_API_KEY = os.getenv("OPENAI_API_KEY")
DATABASE_URL = os.getenv("DATABASE_URL")
CHROMA_PATH = os.getenv("CHROMA_PATH")
```

---

# 🧩 4️⃣ `database.py` (SQLAlchemy + Neon 연결)

📁 `app/database.py`

```python
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker
from app.config import DATABASE_URL

# ✅ SSL 연결 자동 지원 (Neon은 sslmode=require 필수)
engine = create_engine(
    DATABASE_URL,
    connect_args={"sslmode": "require"} if "neon.tech" in DATABASE_URL else {}
)

SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)

def get_db():
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()
```

---

# 🧬 5️⃣ `main.py` (FastAPI + React + DB 확인용)

📁 `app/main.py`

```python
from fastapi import FastAPI, Depends
from fastapi.staticfiles import StaticFiles
from sqlalchemy import text
from app.database import get_db
from app.config import OPENAI_API_KEY
from fastapi.middleware.cors import CORSMiddleware

app = FastAPI(title="AI Career 6 Months")

# ✅ CORS 설정
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_methods=["*"],
    allow_headers=["*"],
)

# ✅ React 정적 파일 서빙 (Vite 빌드 후 dist 폴더)
app.mount("/", StaticFiles(directory="frontend/dist", html=True), name="frontend")

@app.get("/health")
def health_check(db=Depends(get_db)):
    result = db.execute(text("SELECT NOW()")).fetchone()
    return {"status": "ok", "db_time": str(result[0]), "openai_key": bool(OPENAI_API_KEY)}
```

✅ **배포 후 `/health` 페이지에 접속**하면
데이터베이스와 OpenAI Key 정상 연결 여부를 한눈에 확인할 수 있습니다.
예시 응답:

```json
{
  "status": "ok",
  "db_time": "2025-10-14 11:23:41.502817+00",
  "openai_key": true
}
```

---

# 🚀 6️⃣ Render 환경 변수 설정

Render 대시보드에서:

| KEY              | VALUE              |
| ---------------- | ------------------ |
| `ENV`            | `production`       |
| `OPENAI_API_KEY` | `sk-...`           |
| `DATABASE_URL`   | *(Neon에서 복사한 URL)* |
| `CHROMA_PATH`    | `./chroma_db`      |

> 💡 Render는 `.env` 파일을 자동으로 읽지 않기 때문에,
> 반드시 **환경 변수 탭(Environment)** 에 직접 입력해야 합니다.

---

# 🧱 7️⃣ 배포 설정 요약

📁 `render.yaml` (자동 배포 구성 파일)

```yaml
services:
  - type: web
    name: ai-career-6months
    env: python
    plan: free
    buildCommand: |
      cd frontend && npm install && npm run build && cd ..
      poetry install
    startCommand: poetry run uvicorn app.main:app --host 0.0.0.0 --port 10000
    envVars:
      - key: ENV
        value: production
      - key: DATABASE_URL
        sync: false
      - key: OPENAI_API_KEY
        sync: false
```

> Render가 자동으로 Vite → FastAPI → Uvicorn까지 실행하게 됩니다.
> `sync: false`로 지정된 값들은 Render 환경 변수 탭에서 직접 입력합니다.

---

# 💻 8️⃣ 로컬 테스트

```bash
# 로컬 실행
poetry run uvicorn app.main:app --reload

# 브라우저 확인
http://127.0.0.1:8000/health
```

---

# 🧩 전체 구조

```text
ai-career-6months/
 ┣ app/
 ┃ ┣ config.py
 ┃ ┣ database.py
 ┃ ┣ main.py
 ┃ ┣ routers/
 ┃ ┗ services/
 ┣ frontend/
 ┃ ┣ src/
 ┃ ┗ dist/
 ┣ .env.local
 ┣ .env.prod
 ┣ render.yaml
 ┗ pyproject.toml
```

---

# 🧠 요약

| 항목            | 설정                         | 설명                     |
| ------------- | -------------------------- | ---------------------- |
| **DB**        | Neon.tech PostgreSQL       | 무료, SSL 기본, Render와 호환 |
| **APP**       | Render Free Web Service    | Python FastAPI 배포      |
| **Frontend**  | Vite (React)               | Render에서 static serve  |
| **Config 분리** | `.env.local` / `.env.prod` | 환경별 자동 로딩              |
| **Health 체크** | `/health`                  | DB + OpenAI 연결 확인      |

---

이렇게 하면
👉 로컬에서는 SQLite or Local MySQL,
👉 Render 배포 시에는 Neon PostgreSQL
로 자동 전환되며 완전히 클라우드 상에서 작동합니다 ✅

---

원하신다면,
이 설정 기반으로 **Render 배포 직전 테스트용 `deploy_check.py`** (DB 연결 / OpenAI Key / 파일 경로 점검 스크립트)도 만들어드릴까요?
→ “배포 전에 한 번 실행해서 모든 연결이 정상인지 자동 점검”하는 용도입니다.
