ì™€â€¦ğŸ‘ ì§„ì§œ í•µì‹¬ì ì¸ ì§ˆë¬¸ì´ì—ìš”.
ì´ê±´ â€œ**ìš´ì˜í˜• AI í”„ë¡œì íŠ¸ êµ¬ì¡°ë¥¼ ì„¤ê³„í•  ë•Œ ìƒê¸°ëŠ” ì „í˜•ì ì¸ ë¦¬íŒ©í† ë§ í¬ì¸íŠ¸**â€ì˜ˆìš”.

ì •í™•íˆ ë§ìŠµë‹ˆë‹¤ â€”
âœ… `send_slack_message()` ëŠ” **ì—¬ëŸ¬ ëª¨ë“ˆì—ì„œ ë°˜ë³µì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ê³µí†µ ê¸°ëŠ¥**ì´ì—ìš”.
ì¦‰, â€œë¦¬í¬íŠ¸ ì „ì†¡ / ë°±ì—… ì•Œë¦¼ / ì—ëŸ¬ ì•Œë¦¼ / í‰ê°€ ê²°ê³¼ ë³´ê³ â€ ë“±
ì—¬ëŸ¬ ê³³ì—ì„œ Slack í†µí•©ì´ ë°˜ë³µë˜ì£ .

ê·¸ë˜ì„œ ì´ê±´ **ê³µìš© ìœ í‹¸ë¡œ ë¶„ë¦¬í•˜ëŠ” ê²Œ ì •ë‹µ**ì´ì—ìš” ğŸ’¯

---

# ğŸ§© ë¦¬íŒ©í† ë§ ë°©í–¥

| ê¸°ì¡´                        | ê°œì„  í›„                                 |
| ------------------------- | ------------------------------------ |
| ê° íŒŒì¼ë§ˆë‹¤ Slack ë©”ì‹œì§€ ì „ì†¡ ì½”ë“œ ì¤‘ë³µ | `app/utils/slack_notifier.py` í•˜ë‚˜ë¡œ í†µí•© |
| HTTP ìš”ì²­, í—¤ë”, ì±„ë„ ì„¤ì •ì´ ì¤‘ë³µë¨   | ì¬ì‚¬ìš© ê°€ëŠ¥ í•¨ìˆ˜ + ê°„ë‹¨í•œ import               |
| ì—ëŸ¬ ì‹œ ì¼ê´€ë˜ì§€ ì•Šì€ ë¡œê·¸           | í†µí•© ë¡œê¹… ë° ì˜ˆì™¸ì²˜ë¦¬ ê°€ëŠ¥                      |

---

# ğŸ“ **ì¶”ì²œ êµ¬ì¡°**

```
ai-career-6months/
 â”£ app/
 â”ƒ â”£ utils/
 â”ƒ â”ƒ â”£ slack_notifier.py     ğŸ‘ˆ ê³µí†µ Slack ìœ í‹¸
 â”ƒ â”ƒ â”£ report_utils.py
 â”ƒ â”ƒ â”— db_cleanup.py
 â”ƒ â”£ routes/
 â”ƒ â”ƒ â”£ report.py
 â”ƒ â”ƒ â”— maintenance.py
 â”ƒ â”— ...
 â”— ...
```

---

# ğŸ“˜ **`app/utils/slack_notifier.py`**

```python
"""
slack_notifier.py
----------------------------------
Slack ë©”ì‹œì§€ ë° íŒŒì¼ ì—…ë¡œë“œ ê³µí†µ ìœ í‹¸
----------------------------------
- Slack BOT Token ë° Channel í™˜ê²½ë³€ìˆ˜ ê¸°ë°˜
- í…ìŠ¤íŠ¸, íŒŒì¼ ì „ì†¡ ëª¨ë‘ ì§€ì›
- ëª¨ë“  ëª¨ë“ˆì—ì„œ import í›„ ì¬ì‚¬ìš© ê°€ëŠ¥
"""

import os
import requests

SLACK_BOT_TOKEN = os.getenv("SLACK_BOT_TOKEN")
SLACK_CHANNEL = os.getenv("SLACK_CHANNEL", "ai-reports")

def send_slack_message(text: str, file_path: str = None):
    """Slackìœ¼ë¡œ ë©”ì‹œì§€ ë˜ëŠ” íŒŒì¼ ì „ì†¡"""
    if not SLACK_BOT_TOKEN:
        print("âš ï¸ SLACK_BOT_TOKEN not set. Skipping Slack message.")
        return {"ok": False, "error": "missing_token"}

    headers = {"Authorization": f"Bearer {SLACK_BOT_TOKEN}"}
    data = {"channels": SLACK_CHANNEL, "initial_comment": text}

    try:
        # íŒŒì¼ì´ ìˆìœ¼ë©´ íŒŒì¼ ì—…ë¡œë“œ
        if file_path and os.path.exists(file_path):
            with open(file_path, "rb") as f:
                response = requests.post(
                    "https://slack.com/api/files.upload",
                    headers=headers,
                    data=data,
                    files={"file": f},
                )
        else:
            # í…ìŠ¤íŠ¸ ë©”ì‹œì§€ ì „ì†¡
            response = requests.post(
                "https://slack.com/api/chat.postMessage",
                headers=headers,
                json={"channel": SLACK_CHANNEL, "text": text},
            )

        result = response.json()
        if result.get("ok"):
            print(f"âœ… Slack ì „ì†¡ ì™„ë£Œ â†’ #{SLACK_CHANNEL}")
        else:
            print(f"âŒ Slack ì˜¤ë¥˜: {result.get('error')}")
        return result

    except Exception as e:
        print(f"âŒ Slack ì „ì†¡ ì¤‘ ì˜ˆì™¸ ë°œìƒ: {e}")
        return {"ok": False, "error": str(e)}
```

---

# ğŸ“— **`app/utils/db_cleanup.py` (ë¦¬íŒ©í† ë§ëœ ë²„ì „)**

```python
from datetime import datetime, timedelta
from sqlalchemy import create_engine, text
import os, pandas as pd
from app.utils.slack_notifier import send_slack_message  # âœ… ê³µìš© ëª¨ë“ˆ import

DATABASE_URL = os.getenv("DATABASE_URL", "sqlite:///./local.db")
engine = create_engine(DATABASE_URL)
LOG_RETENTION_DAYS = int(os.getenv("LOG_RETENTION_DAYS", 30))

BACKUP_DIR = os.path.join(os.path.dirname(os.path.dirname(__file__)), "..", "backups")
os.makedirs(BACKUP_DIR, exist_ok=True)

def backup_and_cleanup_logs():
    cutoff_date = datetime.utcnow() - timedelta(days=LOG_RETENTION_DAYS)
    print(f"ğŸ—“ï¸ ë°±ì—… ê¸°ì¤€ì¼: {cutoff_date}")

    df = pd.read_sql("SELECT * FROM conversation_log WHERE created_at < :cutoff", engine, params={"cutoff": cutoff_date})
    if df.empty:
        msg = f"âœ… ë°±ì—…í•  ì˜¤ë˜ëœ ë¡œê·¸ê°€ ì—†ìŠµë‹ˆë‹¤. (ê¸°ì¤€: {cutoff_date.date()})"
        print(msg)
        send_slack_message(msg)
        return

    backup_filename = f"conversation_log_backup_{cutoff_date.strftime('%Y%m%d')}.csv"
    backup_path = os.path.join(BACKUP_DIR, backup_filename)
    df.to_csv(backup_path, index=False, encoding="utf-8-sig")

    delete_query = text("DELETE FROM conversation_log WHERE created_at < :cutoff")
    with engine.begin() as conn:
        conn.execute(delete_query, {"cutoff": cutoff_date})

    msg = (
        f"ğŸ’¾ *DB Cleanup Report*\n"
        f"- íŒŒì¼: `{backup_filename}`\n"
        f"- ë°±ì—… ìˆ˜: {len(df)} rows\n"
        f"- ê¸°ì¤€ì¼: {cutoff_date.date()}\n"
        f"- ì‹¤í–‰: {datetime.utcnow().strftime('%Y-%m-%d %H:%M:%S UTC')}"
    )

    send_slack_message(msg, backup_path)
    print("âœ… ë°±ì—… ë° Slack ì „ì†¡ ì™„ë£Œ.")
```

---

# ğŸ“™ **ë‹¤ë¥¸ ëª¨ë“ˆì—ì„œë„ ì¬ì‚¬ìš© ê°€ëŠ¥**

### âœ… `app/utils/report_utils.py`

```python
from app.utils.slack_notifier import send_slack_message

def generate_and_send_report():
    ...
    send_slack_message("ğŸ“Š Daily Report Generated", "reports/sentiment_ratio.png")
```

### âœ… `app/evaluate_response.py`

```python
from app.utils.slack_notifier import send_slack_message

def run_evaluation():
    ...
    send_slack_message("ğŸ¤– Evaluation Complete", None)
```

---

# ğŸ§  **ì´ë ‡ê²Œ êµ¬ì¡°ë¥¼ ë°”ê¾¸ë©´ ìƒê¸°ëŠ” ì¥ì **

| í•­ëª©                | íš¨ê³¼                                         |
| ----------------- | ------------------------------------------ |
| ğŸ¯ **ì½”ë“œ ì¤‘ë³µ ì œê±°**   | Slack ê´€ë ¨ ì½”ë“œê°€ í•œ íŒŒì¼ë¡œ í†µí•©                      |
| ğŸ§© **ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ**   | Slack API ë°”ë€Œì–´ë„ í•œ ê³³ë§Œ ìˆ˜ì •                     |
| ğŸ’¬ **ì¼ê´€ëœ ë©”ì‹œì§€ í¬ë§·** | ì•Œë¦¼ ìŠ¤íƒ€ì¼ í†µì¼ (ì´ëª¨ì§€, ì„œì‹, ì±„ë„)                    |
| âš™ï¸ **í™•ì¥ ìš©ì´ì„±**     | ë‚˜ì¤‘ì— Discord, Email ì•Œë¦¼ ì¶”ê°€ë„ ì‰¬ì›€               |
| â˜ï¸ **í™˜ê²½ë³€ìˆ˜ ì¼ì›í™”**   | `SLACK_BOT_TOKEN`, `SLACK_CHANNEL` í•œ ë²ˆë§Œ ê´€ë¦¬ |

---

# ğŸ’¡ í™•ì¥ ì•„ì´ë””ì–´ (ë‹¤ìŒ ë‹¨ê³„)

âœ… `send_slack_message()`ë¥¼ ë” ê³ ë„í™”í•´ì„œ:

* `message_type` ë§¤ê°œë³€ìˆ˜ (`info`, `error`, `success`)ë¡œ ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ ë³€ê²½
* `attachments` / `blocks` APIë¡œ **ì°¨íŠ¸ ìš”ì•½ ì‹œê°í™” ì§€ì›**
* `thread_ts`ë¡œ **ë¦¬í¬íŠ¸ ìŠ¤ë ˆë“œ ê´€ë¦¬ (1ì£¼ì¼ì¹˜ ë¬¶ìŒ)**

---

ìš”ì•½í•˜ìë©´ ğŸ‘‡

> `send_slack_message()`ëŠ” **ë¬´ì¡°ê±´ ë”°ë¡œ ë¶„ë¦¬**í•˜ëŠ” ê²Œ ì •ë‹µì´ì—ìš”.
> ì´ê±¸ `app/utils/slack_notifier.py`ë¡œ ë¹¼ë‘ë©´
> DB ì •ë¦¬, ë¦¬í¬íŠ¸, í‰ê°€, ë°°í¬ ì•Œë¦¼ ë“± ëª¨ë“  ê³³ì—ì„œ ì¬ì‚¬ìš© ê°€ëŠ¥í•˜ê³ 
> ìš´ì˜í˜• í”„ë¡œì íŠ¸ ìˆ˜ì¤€ìœ¼ë¡œ ê¹”ë”í•´ì§‘ë‹ˆë‹¤. âœ…

---

ì›í•˜ì‹ ë‹¤ë©´ âœ¨
`send_slack_message()`ë¥¼ **message_typeë³„ ìŠ¤íƒ€ì¼ë§ (ì„±ê³µâœ… / ê²½ê³ âš ï¸ / ì˜¤ë¥˜âŒ)** ë¡œ í™•ì¥í•œ
**í”„ë¡œë•ì…˜ ì•Œë¦¼ ë²„ì „**ìœ¼ë¡œ ë§Œë“¤ì–´ë“œë¦´ê¹Œìš”?
(â†’ ë©”ì‹œì§€ ìƒ‰ìƒ, ì´ëª¨ì§€, í—¤ë”, í…ìŠ¤íŠ¸ ìë™ í¬ë§· í¬í•¨)
