정말 좋아요 👍
지금 질문하신 “**자동 실행 스케줄러(schedule 모듈) 적용**”은
9주차 목표 중에서도 “AI 리포트 자동화”를 완성하는 핵심 단계예요.

즉, **수동으로 실행하던 분석 스크립트(`app/analyze_feedback.py`)를 일정 주기로 자동 실행**되게 만드는 겁니다.
이걸 로컬에서 테스트하고, 이후 Render 배포환경에서도 돌아가게 확장할 수 있어요 🚀

---

# 🧭 9주차 자동 실행 스케줄러 적용 가이드

---

## 1️⃣ 개념 먼저 정리

| 항목                 | 설명                                    |
| ------------------ | ------------------------------------- |
| 🧠 **schedule 모듈** | 파이썬용 경량 스케줄러 (크론 없이 작동 가능)            |
| 🕒 **작동 방식**       | 특정 간격마다 지정된 함수를 자동 실행                 |
| 💡 **예시**          | “매일 오전 9시에 리포트 생성 함수 실행”              |
| ⚙️ **장점**          | FastAPI 서버와 별도로 백그라운드 자동화 가능          |
| ☁️ **Render 확장**   | Render Background Worker 로 24시간 실행 가능 |

---

## 2️⃣ 필수 패키지 설치

```bash
poetry add schedule
```

---

## 3️⃣ 리포트 자동화 스크립트 만들기

📁 `app/scheduler_report.py`

```python
"""
scheduler_report.py
------------------------------------
AI Career 6 Months - 자동 리포트 스케줄러

기능:
 - conversation_log DB 분석
 - 감정/주제 비율 리포트 생성
 - 일정 간격으로 반복 실행
------------------------------------
"""

import os
import time
import schedule
import pandas as pd
import matplotlib.pyplot as plt
from sqlalchemy import create_engine

# 환경 변수 설정
DATABASE_URL = os.getenv("DATABASE_URL", "sqlite:///./local.db")
engine = create_engine(DATABASE_URL)

# 리포트 저장 경로 (프로젝트 루트 기준)
REPORT_DIR = os.path.join(os.path.dirname(os.path.dirname(__file__)), "reports")
os.makedirs(REPORT_DIR, exist_ok=True)


def generate_report():
    """리포트 생성 함수"""
    print("📊 [REPORT] Generating AI feedback report...")

    df = pd.read_sql("SELECT * FROM conversation_log", engine)
    if df.empty:
        print("⚠️ No conversation data yet.")
        return

    # 감정 비율 계산
    sentiment_counts = df["sentiment"].value_counts(normalize=True)
    topic_counts = df["topic"].value_counts().head(10)

    # 감정 그래프
    plt.figure(figsize=(6, 4))
    sentiment_counts.plot(kind="bar", title="Sentiment Ratio")
    plt.tight_layout()
    plt.savefig(os.path.join(REPORT_DIR, "sentiment_ratio.png"))
    plt.close()

    # 주제 그래프
    plt.figure(figsize=(6, 4))
    topic_counts.plot(kind="bar", title="Top Topics")
    plt.tight_layout()
    plt.savefig(os.path.join(REPORT_DIR, "top_topics.png"))
    plt.close()

    print(f"✅ Report generated successfully in {REPORT_DIR}")


# --------------------------------------
# 🔁 스케줄 설정
# --------------------------------------

# 매일 오전 9시에 실행
schedule.every().day.at("09:00").do(generate_report)

# 매시간 테스트용 (원하면 주석 해제)
# schedule.every(1).hours.do(generate_report)

# 첫 실행 즉시 리포트 1회 생성
generate_report()

print("🚀 Scheduler started! Waiting for next run...")

# 무한 루프 실행 (Render Background Worker에서도 사용 가능)
while True:
    schedule.run_pending()
    time.sleep(60)
```

---

## 4️⃣ 로컬 테스트 방법

```bash
poetry run python -m app.scheduler_report
```

💡 결과:

```
📊 [REPORT] Generating AI feedback report...
✅ Report generated successfully in C:\workdir\ai-career-6months\reports
🚀 Scheduler started! Waiting for next run...
```

→ 처음 1회 실행 후, 매일 오전 9시에 자동으로 다음 리포트가 생성됩니다.

---

## 5️⃣ 실행 주기 조정법

| 주기           | 코드                                                        |
| ------------ | --------------------------------------------------------- |
| 매일 오전 9시     | `schedule.every().day.at("09:00").do(generate_report)`    |
| 매시간 실행       | `schedule.every(1).hours.do(generate_report)`             |
| 10분마다        | `schedule.every(10).minutes.do(generate_report)`          |
| 매주 월요일 오전 8시 | `schedule.every().monday.at("08:00").do(generate_report)` |

---

## 6️⃣ Render Background Worker에 적용하려면

Render에서는 웹 서비스가 24시간 돌아가야 하는데,
이 스크립트(`scheduler_report.py`)를 별도 **Background Worker**로 설정하면 완벽하게 자동화됩니다.

### 📘 방법:

1️⃣ Render Dashboard → “New → Background Worker” 선택
2️⃣ GitHub 저장소 연결
3️⃣ **Start Command** 설정:

```bash
poetry run python -m app.scheduler_report
```

4️⃣ 환경 변수 추가:

* `DATABASE_URL`
* `OPENAI_API_KEY`

5️⃣ 저장 → 배포 완료

> 이제 Render가 서버 대신 `scheduler_report.py`를 24시간 실행하면서
> 매일 리포트를 자동 생성합니다.

---

## 7️⃣ 리포트 결과 확인

📂 생성 파일:

```
ai-career-6months/reports/
 ┣ sentiment_ratio.png
 ┗ top_topics.png
```

> 필요하다면 이후 단계(9주차)에서 이 리포트를 자동으로 Slack, Discord, 또는 이메일로 전송하도록 확장할 수 있습니다.

---

## 🧩 요약 정리

| 항목           | 설명                          |
| ------------ | --------------------------- |
| 🎯 목적        | 리포트 자동 생성 (매일 or 주기적)       |
| ⚙️ 모듈        | `schedule`                  |
| 📁 실행 파일     | `app/scheduler_report.py`   |
| 🕒 실행 주기     | 매일 오전 9시 (커스터마이즈 가능)        |
| ☁️ Render 적용 | Background Worker로 상시 실행 가능 |
| 💾 결과물       | `reports/` 폴더 내 리포트 이미지     |

---

원하신다면 ✨
이 스케줄러가 매일 리포트를 자동 생성한 후
📬 **Slack / Discord / Email로 리포트를 전송하는 버전** 도 만들어드릴까요?
→ AI 리포트가 자동으로 알림 메시지로 도착하게 할 수 있어요.
