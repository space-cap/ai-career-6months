좋아요 👏
이제 Week 15의 하이라이트 — **“양방향 운영 자동화 시스템”** 버전으로 확장해드릴게요 🚀

이 버전은 두 가지 기능이 추가됩니다:

1️⃣ **Slack에서 버튼 클릭 → 즉시 리포트 생성 & 업로드**
2️⃣ **Dashboard에서도 “📄 Generate Report Now” 버튼 → Slack 자동 업로드**

즉, 관리자는 *명령어나 클릭 한 번으로 즉시 리포트 생성과 전송이 가능*해집니다.

---

# 🧭 **Week 15 Pro 버전 — 양방향 리포트 자동화**

---

## 📁 **폴더 구조 (업데이트 버전)**

```
ai-career-6months/
 ┣ app/
 ┃ ┣ utils/
 ┃ ┃ ┣ report_generator.py
 ┃ ┃ ┣ slack_uploader.py
 ┃ ┃ ┣ slack_command_handler.py   👈 Slack 명령 처리 추가
 ┃ ┗ generate_weekly_report.py
 ┣ dashboards/
 ┃ ┗ admin_dashboard.py
 ┣ reports/
 ┗ ...
```

---

## 💬 **1️⃣ Slack 명령으로 리포트 생성하기**

📄 `app/utils/slack_command_handler.py`

```python
"""
slack_command_handler.py
----------------------------------------
Slack 명령(/ai-report)으로 리포트 생성 및 업로드 트리거
----------------------------------------
"""

import os
from fastapi import APIRouter, Request
from fastapi.responses import JSONResponse
from app.utils.report_generator import generate_weekly_report
from app.utils.slack_uploader import upload_to_slack

router = APIRouter()

SLACK_VERIFICATION_TOKEN = os.getenv("SLACK_VERIFICATION_TOKEN")

@router.post("/slack/ai-report")
async def handle_slack_command(request: Request):
    form = await request.form()
    token = form.get("token")
    user = form.get("user_name", "unknown")

    # 보안 검증
    if token != SLACK_VERIFICATION_TOKEN:
        return JSONResponse(content={"text": "❌ Unauthorized Request"}, status_code=401)

    # 즉시 리포트 생성
    path = generate_weekly_report()
    upload_to_slack(path)

    return JSONResponse(content={
        "response_type": "in_channel",
        "text": f"📊 AI 리포트를 {user} 님이 직접 생성했습니다!"
    })
```

✅ FastAPI 라우터를 `/slack/ai-report` 로 등록하면,
Slack → App → Slash Command → “/ai-report” 로 호출 가능합니다.

---

## ⚙️ **2️⃣ Slack 앱 설정**

1️⃣ [Slack API > Your Apps](https://api.slack.com/apps) → 새 App 생성
2️⃣ **Slash Commands** 메뉴에서 다음처럼 등록

| 항목                    | 값                                              |
| --------------------- | ---------------------------------------------- |
| **Command**           | `/ai-report`                                   |
| **Request URL**       | `https://yourapp.onrender.com/slack/ai-report` |
| **Short Description** | “AI 주간 리포트 즉시 생성”                              |
| **Usage Hint**        | `[optional text]`                              |

3️⃣ **Verification Token** 값을 `.env` 에 추가

```bash
SLACK_VERIFICATION_TOKEN=xxxx-your-token-xxxx
```

4️⃣ 이제 Slack 채널에서 👇 입력하면

```
/ai-report
```

즉시 리포트 생성 → Slack PDF 업로드 완료 🎉

---

## 🧾 **3️⃣ Dashboard에서 “Generate Report Now” 버튼**

📄 `dashboards/admin_dashboard.py`

```python
import streamlit as st
from app.utils.report_generator import generate_weekly_report
from app.utils.slack_uploader import upload_to_slack
import os

st.set_page_config(page_title="AI Admin Dashboard", layout="wide")
st.title("🧠 AI 운영 관리자 대시보드")
st.markdown("---")

tab1, tab2, tab3 = st.tabs(["📊 AI Performance", "🧾 Feedback Summary", "📄 Weekly Report"])

with tab3:
    st.subheader("📄 AI Weekly Report Management")

    if st.button("📄 Generate Report Now"):
        with st.spinner("리포트 생성 중..."):
            path = generate_weekly_report()
            upload_to_slack(path)
        st.success("✅ 리포트가 성공적으로 생성되어 Slack으로 전송되었습니다!")
        st.download_button("⬇️ 다운로드", data=open(path, "rb"), file_name=os.path.basename(path))

    st.caption("Slack에서 /ai-report 명령으로도 즉시 생성할 수 있습니다.")
```

---

## 🧩 **4️⃣ FastAPI 라우터 등록**

📄 `app/main.py` (또는 `routers/slack.py` 파일에 추가)

```python
from fastapi import FastAPI
from app.utils.slack_command_handler import router as slack_router

app = FastAPI()
app.include_router(slack_router)
```

---

## 🧠 **5️⃣ 실행 시나리오**

| 경로                   | 설명                             |
| -------------------- | ------------------------------ |
| Slack → `/ai-report` | 명령어로 AI 리포트 즉시 생성 & 업로드        |
| Dashboard → 📄 버튼 클릭 | 관리자 페이지에서 직접 리포트 생성 & Slack 전송 |
| Cron or Schedule     | 매주 자동 생성 (백그라운드)               |

---

## 💬 **Slack 메시지 예시**

```
📄 AI 주간 리포트 업로드 완료!
기간: 2025-10-13 ~ 2025-10-20
- 총 대화: 1 245 건  
- 평균 평가: 8.2 점  
- 좋아요: 324  /  싫어요: 55  
📎 첨부파일: weekly_report_2025_10_20.pdf
```

---

## ✅ **Week 15 Pro 버전 Notion 체크리스트**

```
✅ Week 15 — AI 운영 리포트 양방향 자동화 (Pro 버전)

🎯 목표
- Slack 명령어(/ai-report)로 리포트 즉시 생성 & 전송
- Dashboard 에서 버튼 클릭으로 Slack 리포트 자동 발송
- 완전한 운영 자동화 루프 완성

📅 작업 항목
- [ ] app/utils/slack_command_handler.py 추가  
- [ ] FastAPI 라우터 등록 (main.py)  
- [ ] Slack App Slash Command 등록  
- [ ] dashboards/admin_dashboard.py 버튼 추가  
- [ ] 테스트 : Slack → 리포트 업로드 정상 동작  
- [ ] 테스트 : Dashboard → Slack 연동 정상 동작
```

---

## 🧩 **요약**

| 기능               | 설명                                 |
| ---------------- | ---------------------------------- |
| **/ai-report**   | Slack에서 리포트 즉시 생성                  |
| **Dashboard 버튼** | 관리자 UI에서 즉시 리포트 생성 및 Slack 업로드     |
| **자동화 루프**       | 매주 스케줄 + 수동 트리거 모두 가능              |
| **보안**           | Slack Verification Token 으로 API 검증 |

---

원하신다면 🔥
이 시스템을 Render에서 **`worker` 프로세스로 분리**해서
(즉 리포트 생성만 별도 백엔드 컨테이너에서 동작하도록)
**`render.yaml` 자동화 버전**까지 만들어드릴까요?
