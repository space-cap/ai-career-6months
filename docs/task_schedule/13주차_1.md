좋아요 👏
Week 13은 **AI 성능 관리와 고도화** 단계로 가는 시점이에요.
지금까지 피드백 기반으로 재학습 루프를 만들었으니, 이번 주에는 그 **성과를 수치로 측정하고 개선을 체계화**합니다.

---

# 🧭 **Week 13 — AI 성능 지표 기반 자동 튜닝 (AI Performance Optimization)**

> “AI가 스스로 개선하는 시스템을 넘어,
> **데이터 + 지표 + 모델 튜닝**을 통해 실제 성능 향상을 관리한다.”

---

## 🎯 **이번 주 목표**

* AI 응답 품질 지표(정확도, 일관성, 감정 일치도 등) 설계
* `conversation_evaluation` 테이블 확장 (평균 점수 + 주간 비교 지표)
* 피드백 + 평가 데이터 통합 → AI 성능 Trend 분석
* Slack / Dashboard 양쪽에 **“AI 성능 개선율 리포트”** 자동 전송
* 향후 모델 튜닝용 데이터셋 추출 파이프라인 준비

---

## ⚙️ **핵심 구현 포인트**

| 구분              | 설명                                                       | 기술 요소                     |
| --------------- | -------------------------------------------------------- | ------------------------- |
| 📊 지표 설계        | 품질 (Quality), 정확도 (Accuracy), 피드백 반응 (Feedback Score) 통합 | SQL 분석 + Pandas           |
| 🧮 주간 비교        | 지난주 대비 + / – % 자동 계산                                     | `pandas.merge` + `diff()` |
| 🧠 성능 지표 평균화    | `conversation_evaluation` + `feedback_log` 조인            | SQLAlchemy                |
| 💬 Slack 리포트    | “📈 AI 성능 개선 리포트” 자동 전송                                  | `slack_notifier.py`       |
| 📈 Dashboard 확장 | “AI Performance” 탭 추가 → 평균 점수 라인차트                       | Streamlit + Altair        |

---

## 📁 **폴더 구조 (확장 버전)**

```
ai-career-6months/
 ┣ app/
 ┃ ┣ utils/
 ┃ ┃ ┣ ai_metrics.py          👈 신규 (성능 지표 계산)
 ┃ ┃ ┣ report_utils.py
 ┃ ┃ ┗ slack_notifier.py
 ┃ ┗ auto_feedback_loop.py
 ┣ dashboards/
 ┃ ┗ dashboard.py             👈 “AI Performance” 탭 추가
 ┗ reports/
```

---

## 📘 **예시 코드 : `app/utils/ai_metrics.py`**

```python
"""
ai_metrics.py
----------------------------------------
AI 응답 품질 지표 계산 및 Slack 리포트 전송
----------------------------------------
- conversation_evaluation + feedback_log 통합
- 주간 평균 점수 및 개선율 계산
"""

import os
import pandas as pd
from datetime import datetime, timedelta
from sqlalchemy import create_engine, text
from app.utils.slack_notifier import send_slack_message

DATABASE_URL = os.getenv("DATABASE_URL", "sqlite:///./local.db")
engine = create_engine(DATABASE_URL)

def compute_ai_metrics():
    """AI 품질 지표 계산"""
    with engine.begin() as conn:
        df_eval = pd.read_sql(text("""
            SELECT created_at, score
            FROM conversation_evaluation
            WHERE created_at >= DATE('now', '-14 day')
        """), conn)

        df_feed = pd.read_sql(text("""
            SELECT created_at, feedback
            FROM feedback_log
            WHERE created_at >= DATE('now', '-14 day')
        """), conn)

    # 날짜 단위로 집계
    df_eval['date'] = pd.to_datetime(df_eval['created_at']).dt.date
    df_feed['date'] = pd.to_datetime(df_feed['created_at']).dt.date
    df_feed['like'] = df_feed['feedback'].eq('like').astype(int)
    df_feed['dislike'] = df_feed['feedback'].eq('dislike').astype(int)

    df_eval_daily = df_eval.groupby('date')['score'].mean().reset_index(name='avg_score')
    df_feed_daily = df_feed.groupby('date')[['like', 'dislike']].sum().reset_index()
    df = pd.merge(df_eval_daily, df_feed_daily, on='date', how='outer').fillna(0)

    # 지난주 vs 이번주 비교
    df['week'] = pd.to_datetime(df['date']).dt.isocalendar().week
    current_week = df['week'].max()
    prev_week = current_week - 1

    cur_avg = df.loc[df['week'] == current_week, 'avg_score'].mean()
    prev_avg = df.loc[df['week'] == prev_week, 'avg_score'].mean()
    diff = (cur_avg - prev_avg) / prev_avg * 100 if prev_avg else 0

    like_total = df['like'].sum()
    dislike_total = df['dislike'].sum()

    # Slack 메시지 전송
    msg = (
        f"📈 *AI 성능 개선 리포트*\n"
        f"- 이번주 평균 점수: {cur_avg:.2f}\n"
        f"- 지난주 평균 점수: {prev_avg:.2f}\n"
        f"- 변화율: {diff:+.1f}%\n"
        f"- 👍 {like_total} / 👎 {dislike_total}\n"
        f"- 생성시각: {datetime.now().strftime('%Y-%m-%d %H:%M')}"
    )

    send_slack_message(msg)
    print("✅ AI Metrics Report 전송 완료")
```

---

## 📊 **Dashboard 확장 (Performance 탭)**

📄 `dashboards/dashboard.py`

```python
tab5 = st.tabs(["🚀 AI Performance"])[0]

with tab5:
    st.header("AI Performance Trend")
    perf_df = pd.read_sql("""
        SELECT DATE(created_at) as date, AVG(score) as avg_score
        FROM conversation_evaluation
        GROUP BY date ORDER BY date
    """, engine)

    chart = alt.Chart(perf_df).mark_line(point=True).encode(
        x="date:T", y="avg_score:Q"
    ).properties(width=800, height=400)

    st.altair_chart(chart, use_container_width=True)
```

---

## 🧩 **Slack 메시지 예시**

```
📈 AI 성능 개선 리포트
- 이번주 평균 점수: 8.3
- 지난주 평균 점수: 7.5
- 변화율: +10.7%
- 👍 52 / 👎 11
- 생성시각: 2025-10-17 09:00
```

---

## ✅ **Week 13 Notion 체크리스트 + 코드 링크**

```
✅ Week 13 — AI 성능 지표 기반 자동 튜닝

🎯 목표
- AI 응답 품질 지표 (평균 점수, 피드백 비율) 계산
- 지난주 대비 개선율 자동 산출
- Slack 리포트 및 Dashboard 시각화 통합

📅 작업 항목
- [ ] app/utils/ai_metrics.py 생성
- [ ] conversation_evaluation + feedback_log 통합
- [ ] Slack 리포트 자동 전송 로직 추가
- [ ] Dashboard 에 AI Performance 탭 추가
- [ ] auto_feedback_loop 에서 metrics 함수 호출

🧩 코드 링크
- [ ] app/utils/ai_metrics.py
- [ ] app/utils/report_utils.py
- [ ] dashboards/dashboard.py
- [ ] app/auto_feedback_loop.py
```

---

## 🧠 **한줄 요약**

> “Week 13은 AI의 ‘감정’이 아니라 ‘성능’을 읽는 시점이다.
> 데이터를 측정하고, 지표로 개선 성과를 관리한다.” 📈

---

원하신다면 ✨
이 AI 지표 분석을 **“Slack + Dashboard 양방향 통합 버전”** 으로
(즉 Slack 버튼으로 Dashboard 로 이동 + Dashboard 에서 Slack 리포트 트리거 가능) 확장해드릴까요?
