좋아요 🙌
이제 우리가 만든 **`auto_feedback_loop.py`** 를
Render의 무료 플랜에서도 매일 자동으로 실행되게 만들겠습니다.

Render 자체에는 무료 cron 기능이 없으므로,
외부 무료 스케줄링 서비스인 **[cron-job.org](https://cron-job.org/)** 를 활용합니다.
이건 단 한 번 설정하면 매일 정해진 시각에 자동으로 `/run-feedback-loop` API를 호출해 줍니다.

---

# 🧭 **Render 자동 실행 설정 가이드 (cron-job.org 연동)**

---

## ✅ **1️⃣ 사전 준비**

1. Render에 배포된 FastAPI 백엔드가 있어야 합니다.
   예:

   ```
   https://ai-career-6months.onrender.com
   ```

2. `app/routes/maintenance.py` 에 다음 엔드포인트가 있어야 합니다 👇

   ```python
   @router.get("/run-feedback-loop")
   def run_feedback(background_tasks: BackgroundTasks):
       background_tasks.add_task(run_feedback_loop)
       return {"status": "Feedback loop started"}
   ```

3. 위 API를 수동으로 테스트합니다:

   ```
   GET https://ai-career-6months.onrender.com/run-feedback-loop
   ```

   ✅ 200 OK와 `{"status": "Feedback loop started"}` 가 나오면 준비 완료입니다.

---

## ⚙️ **2️⃣ cron-job.org 가입 및 설정**

### 📍 단계별 안내

1️⃣ **사이트 접속**
👉 [https://cron-job.org](https://cron-job.org)
무료로 가입하세요 (이메일 인증 필요)

2️⃣ **새 Cron Job 생성**
`Create Cronjob` 클릭 후 아래 항목 입력합니다 👇

| 설정 항목                  | 입력 값                                                       |
| ---------------------- | ---------------------------------------------------------- |
| **Title**              | AI Feedback Loop                                           |
| **URL**                | `https://ai-career-6months.onrender.com/run-feedback-loop` |
| **Execution schedule** | Every day → at 09:00 (KST 기준은 00:00 UTC)                   |
| **Request Method**     | `GET`                                                      |
| **Monitoring**         | ON (optional, 실행 실패시 이메일 알림)                               |
| **Email me when**      | Error or no response                                       |

3️⃣ **Advanced Settings**
(기본값 유지, 인증이나 쿠키 필요 없음)

4️⃣ **Save Job**

---

## 🕒 **3️⃣ 실행 예시**

설정 후 다음과 같이 동작합니다 👇

| 날짜         | 실행 시간 | 상태        | 로그                                          |
| ---------- | ----- | --------- | ------------------------------------------- |
| 2025-10-17 | 09:00 | ✅ Success | `Feedback loop started → Slack Report sent` |
| 2025-10-18 | 09:00 | ✅ Success | `Retrain triggered (ratio=0.41)`            |
| 2025-10-19 | 09:00 | ⚠️ Failed | (DB 연결 실패 시 이메일 알림)                         |

---

## 💬 **4️⃣ Slack 결과 (자동화 리포트 예시)**

```
🧠 AI Feedback Loop Report
- 👍 좋아요: 87
- 👎 싫어요: 13
- 총 피드백: 100
- 부정 비율: 13.0%
- 상태: ✅ 정상 유지
- 생성 시각: 2025-10-17 09:00
📊 실시간 Dashboard 보기
```

---

## 📄 **5️⃣ 주기 변경 (필요 시)**

| 주기     | 설정 값                            |
| ------ | ------------------------------- |
| 매일 1회  | “Every day at 09:00”            |
| 매주 월요일 | “Every week on Monday at 09:00” |
| 매시간 1회 | “Every hour” (테스트용)             |
| 주말만    | “Custom → Sat & Sun at 10:00”   |

---

## 🧩 **6️⃣ 옵션: Slack 알림 모니터링 연동**

`send_slack_message()` 안에 아래 한 줄 추가하면,
cron-job 실행 상태를 Slack에 같이 보고할 수도 있습니다 👇

```python
send_slack_message(f"🕒 Feedback Loop started by cron-job.org ({datetime.now().strftime('%Y-%m-%d %H:%M')})")
```

이렇게 하면 Slack에서

> “🕒 Feedback Loop started by cron-job.org (2025-10-17 09:00)”
> 이 자동으로 함께 올라옵니다 ✅

---

## ✅ **최종 점검 체크리스트**

| 항목                                | 확인 |
| --------------------------------- | -- |
| `/run-feedback-loop` API가 정상 응답한다 | ☑️ |
| `cron-job.org`에 URL 등록 완료         | ☑️ |
| Slack 리포트 수신 정상 확인                | ☑️ |
| 매일 09시 자동 실행 로그 확인                | ☑️ |
| 부정 비율 초과 시 재임베딩 자동 수행             | ☑️ |

---

## 📦 **요약**

| 항목        | 내용                              |
| --------- | ------------------------------- |
| 자동화 도구    | cron-job.org (무료)               |
| 호출 URL    | `/run-feedback-loop`            |
| 주기        | 매일 09:00                        |
| 결과 전송     | Slack “AI Feedback Loop Report” |
| 백엔드 수정 필요 | 없음 (이미 FastAPI 라우트로 구성 완료)      |

---

원하신다면 🔥
이 cron-job을 Render에서 **스케줄 Worker 프로세스로 교체하는 유료 플랜용 설정(render.yaml)** 버전도 만들어드릴까요?
(→ 외부 서비스 없이 Render 내부에서 자동 실행되게)
