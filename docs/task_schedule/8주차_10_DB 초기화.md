ì¢‹ì•„ìš” ğŸ‘
ì•„ë˜ëŠ” **ë¡œì»¬(SQLite)** ê³¼ **Render/Neon(PostgreSQL)** ì–‘ìª½ì—ì„œ ëª¨ë‘ ë™ì‘í•˜ëŠ”
ì™„ì „í•œ ë²„ì „ì˜ `init_db.py` ì…ë‹ˆë‹¤.

ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” FastAPI ì„œë²„ë¥¼ ì‹¤í–‰í•˜ì§€ ì•Šê³ ë„
ëª…ë ¹ í•œ ì¤„ë¡œ **DB í…Œì´ë¸”(`conversation_log`)ì„ ìë™ ìƒì„±**í•  ìˆ˜ ìˆë„ë¡ ë§Œë“¤ì–´ì¡Œì–´ìš”.

---

# ğŸ“ `app/init_db.py`

```python
"""
init_db.py
------------------------------------------
AI Career 6 Months í”„ë¡œì íŠ¸ìš© DB ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸

âœ… ê¸°ëŠ¥:
  - DATABASE_URL(.env ë˜ëŠ” Render í™˜ê²½ë³€ìˆ˜) ìë™ ë¡œë“œ
  - SQLAlchemy Base ëª¨ë¸ ê¸°ë°˜ í…Œì´ë¸” ìë™ ìƒì„±
  - ë¡œì»¬(SQLite) ë˜ëŠ” Render/Neon(PostgreSQL) ëª¨ë‘ ì§€ì›
  - í˜„ì¬ ì—°ê²°ëœ DB URLê³¼ í…Œì´ë¸” ëª©ë¡ ì¶œë ¥

ì‹¤í–‰:
  poetry run python app/init_db.py
------------------------------------------
"""

import os
import sys
from sqlalchemy import create_engine, inspect
from sqlalchemy.exc import SQLAlchemyError
from app.models import Base

# ------------------------------------------
# 1ï¸âƒ£ í™˜ê²½ ë³€ìˆ˜ ë¡œë“œ (.env.local ë˜ëŠ” .env.prod)
# ------------------------------------------
from dotenv import load_dotenv

# ìš°ì„ ìˆœìœ„: .env.prod â†’ .env.local
if os.path.exists(".env.prod"):
    load_dotenv(".env.prod")
elif os.path.exists(".env.local"):
    load_dotenv(".env.local")

# ------------------------------------------
# 2ï¸âƒ£ DATABASE_URL ê°€ì ¸ì˜¤ê¸°
# ------------------------------------------
DATABASE_URL = os.getenv("DATABASE_URL")

if not DATABASE_URL:
    print("âŒ ERROR: DATABASE_URLì´ ì„¤ì •ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.")
    print("ğŸ‘‰ .env.local ë˜ëŠ” .env.prod íŒŒì¼ì„ í™•ì¸í•˜ì„¸ìš”.")
    sys.exit(1)

print(f"ğŸ”— Connecting to database: {DATABASE_URL}")

# ------------------------------------------
# 3ï¸âƒ£ DB ì—”ì§„ ìƒì„±
# ------------------------------------------
try:
    engine = create_engine(DATABASE_URL, pool_pre_ping=True)
except Exception as e:
    print(f"âŒ ë°ì´í„°ë² ì´ìŠ¤ ì—”ì§„ ìƒì„± ì‹¤íŒ¨: {e}")
    sys.exit(1)

# ------------------------------------------
# 4ï¸âƒ£ í…Œì´ë¸” ìƒì„±
# ------------------------------------------
try:
    Base.metadata.create_all(bind=engine)
    print("âœ… ëª¨ë“  í…Œì´ë¸”ì´ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.")
except SQLAlchemyError as e:
    print(f"âŒ í…Œì´ë¸” ìƒì„± ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {e}")
    sys.exit(1)

# ------------------------------------------
# 5ï¸âƒ£ ìƒì„±ëœ í…Œì´ë¸” ëª©ë¡ ì¶œë ¥
# ------------------------------------------
try:
    inspector = inspect(engine)
    tables = inspector.get_table_names()
    if tables:
        print("ğŸ“‹ ìƒì„±ëœ í…Œì´ë¸” ëª©ë¡:")
        for t in tables:
            print(f"   â€¢ {t}")
    else:
        print("âš ï¸ ìƒì„±ëœ í…Œì´ë¸”ì´ ì—†ìŠµë‹ˆë‹¤.")
except Exception as e:
    print(f"âš ï¸ í…Œì´ë¸” í™•ì¸ ì¤‘ ì˜¤ë¥˜: {e}")

print("ğŸ‰ DB ì´ˆê¸°í™”ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.")
```

---

# ğŸ“ `app/models.py` (ì°¸ê³ ìš© â€” í˜¹ì‹œ ì—†ë‹¤ë©´ ì¶”ê°€)

```python
from sqlalchemy import Column, Integer, String, Text, DateTime, func
from sqlalchemy.ext.declarative import declarative_base

Base = declarative_base()

class ConversationLog(Base):
    __tablename__ = "conversation_log"

    id = Column(Integer, primary_key=True, index=True)
    user_id = Column(String(50))
    question = Column(Text)
    answer = Column(Text)
    sentiment = Column(String(20))
    topic = Column(String(50))
    created_at = Column(DateTime(timezone=True), server_default=func.now())
```

---

# âœ… ì‹¤í–‰ ë°©ë²•

### ğŸ§© ë¡œì»¬ ê°œë°œí™˜ê²½

```bash
poetry run python app/init_db.py
```

â†’ `.env.local` ì˜ `DATABASE_URL` (ex: sqlite:///./local.db)ì„ ê¸°ì¤€ìœ¼ë¡œ DB ìƒì„±

---

### ğŸŒ Render / Neon ë°°í¬í™˜ê²½ (í…ŒìŠ¤íŠ¸ìš©)

```bash
DATABASE_URL="postgresql+psycopg2://neondb_owner:xxxxx@ep-smooth-water-xxx.aws.neon.tech/neondb?sslmode=require" poetry run python app/init_db.py
```

â†’ `.env.prod` ì—†ì´ë„ ì§ì ‘ ì‹¤í–‰ ê°€ëŠ¥

---

# ğŸ” ì‹¤í–‰ ê²°ê³¼ ì˜ˆì‹œ

```
ğŸ”— Connecting to database: postgresql+psycopg2://neondb_owner@ep-smooth-water.../neondb?sslmode=require
âœ… ëª¨ë“  í…Œì´ë¸”ì´ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.
ğŸ“‹ ìƒì„±ëœ í…Œì´ë¸” ëª©ë¡:
   â€¢ conversation_log
ğŸ‰ DB ì´ˆê¸°í™”ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.
```

---

# ğŸ’¡ ì¶”ê°€ íŒ

| í™˜ê²½     | íŒŒì¼                                 | ì„¤ëª…                        |
| ------ | ---------------------------------- | ------------------------- |
| ë¡œì»¬     | `.env.local`                       | SQLite or Local Neon í…ŒìŠ¤íŠ¸ìš© |
| Render | `.env.prod`                        | ë°°í¬ìš© PostgreSQL URL        |
| ëª…ë ¹ì–´    | `poetry run python app/init_db.py` | ì–¸ì œë“  ì´ˆê¸°í™” ê°€ëŠ¥                |
| ì‹¤í–‰ ìœ„ì¹˜  | í”„ë¡œì íŠ¸ ë£¨íŠ¸ (`ai-career-6months/`)     | âœ… ë°˜ë“œì‹œ ë£¨íŠ¸ì—ì„œ ì‹¤í–‰             |

---

ì›í•˜ì‹ ë‹¤ë©´ ğŸ’¾
ì´ ìŠ¤í¬ë¦½íŠ¸ê°€ **FastAPI ì„œë²„ ì‹œì‘ ì‹œ ìë™ ì‹¤í–‰ë˜ë„ë¡ (`on_startup` ì´ë²¤íŠ¸ì— ì—°ê²°)** í•˜ëŠ” ë²„ì „ë„ ë§Œë“¤ì–´ë“œë¦´ê¹Œìš”?
â†’ ë°°í¬ ì‹œ ìë™ìœ¼ë¡œ Neon DB ì´ˆê¸°í™”ê¹Œì§€ ìˆ˜í–‰ë˜ê²Œ ë©ë‹ˆë‹¤.
